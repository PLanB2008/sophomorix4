############################################################
Schema
############################################################

Questions:

lDAPDisplayName  (wird zum befüllen benutzt)
adminDisplayName (tut nicht)


Changes:
1) ----------------------------------------
creationdate
tolerationdate
deactivationdate

oMSyntax 23 (Zeit) --> oMSyntax 64 (utf8 string)
attributeSyntax: 2.5.5.11 --> attributeSyntax: 2.5.5.12

See: https://technet.microsoft.com/en-us/library/cc961740.aspx

Benamung/Unterscheidung:

mailquota bei user mailquota
(Oder kann dasselbe attribut nochmals verwendet werden?)

mailalias bei user? oder kann diese Mailadresse schon eingetragen werden

############################################################
Set password of administrator
############################################################

samba-tool user setpassword Administrator

############################################################
DNS
############################################################

* Alle bisherigen abfragen??:
samba-tool dns query localhost linuxmuster.local @ ALL -U administrator --password Muster!

* DNS-Einträge anlegen:
  # samba-tool dns add localhost linuxmuster.local j1010-p01 A 10.16.100.1 --password=Muster! -U Administrator
  This adds: DN: DC=j1010-p01,DC=linuxmuster.local,CN=MicrosoftDNS,DC=DomainDnsZones,DC=linuxmuster,DC=local
  More??? where ist the IP 10.16.1.100 in ldap

  # samba-tool dns zonecreate localhost 100.16.10.in-addr.arpa --password=Muster! -U Administrator

  # samba-tool dns add localhost 100.16.10.i
n-addr.arpa 1 PTR j1010-p01.linuxmuster.lokal --password=Muster! -U Administrator


#INFO# samba-tool dns serverinfo localhost
samba-tool dns zoneinfo localhost 100.16.10.in-addr.arpa --password=Muster! -U Administrator


############################################################
Tree
############################################################



Forbidden OU's: SCHOOL, GLOBAL
Forbidden tokens: global, ---

############################################################
Scripts
############################################################

Migration:
Three steps:
1) DUMP: run sophomorix-dump on old server
    (dumps to /root/sophomorix-dump)
2) copy the dir /root/sophomorix-dump recursively to new server/stick
3) SUCK IT IN: sophomorix-vampire --datadir /path/to/dumped/dir

to do: add option --restore-config-files (update wiki)
   use config file instead of list in script
test sophomorix-dump on school server
sophomorix dump: warn when target dir exists

role hiddenclass?
bz is in forbidden login hash -> /etc/group
   -> sophomorix-add shows show with option -i name clashes from fixed uidnames
log when a user cannot be created (summary in the end of script)
use project dump to create projects (is all info there)

Type T,D,R not exported?

add encrypted passwords to sophomorix.add

Tasks to do after migration:
projects: add displayname



AD_group_addmember
 add user to group only if they are not member already
 add group to group only if they are not member already


sophomorix-project

add groups with role 'project'
  - p_name (no school_token).
  - projects can contain students of all schools
  - project name length
  - p_longname: description field used
  - Zeitanzeige lesbarer machen (-i -p <name>)

sophomorix-user
how to handle users that are organised in wrong school
  i.e. sophomorisSchoolname is BSZLEO an they are in OU=SCHOOL 


Tests:

if user is admin and should be member -> degrade user
if user is member and should be admin -> upgrade user
           member AND admin -> throw error
dito for groups

--members/admins  nonexisting user -> dont add user 


option sync memberships: go throuh all projects and sync memberships



-> sophomorix-device

macadress in den ldap: https://msdn.microsoft.com/en-us/library/windows/desktop/ms676850%28v=vs.85%29.aspx


add/move/kill
-> logfiles adding, deletion, killing
-> Option -i: 
     - add a table per OU/token 
     - 

sophomorix-kill:
  list of groups tha will never be Killed
  - attic
  - teachers
  - students
  - Windows administrators groups

sophomorix-project
  -> create all groups with role=project
 
Attributes for a group

adding users:
  when role student, then put them in subcontainer CN=class,CN=students


document format of
sophomorix.add, .move, .kill
   - use utf8 in these files 



sophomorix-useradd
  - replace default password 'linux' with 'LinuxMuster!'
  - maybe put all options for adding users  to sophomorix-add

sophomorix-add:   call sophomorix-print correctly 

sophomorix.add:
-> are there umlaute allowed in sophomorix.add at the moment?
- expect sophomorix.add as utf8 encoded with umlaute and others

-> Additional fields 
     DONE school_token
     DONE ou 


sophomorix-print:

     - Full utf8 support
       (Firstnames, Surnames will be utf8 encoded)
     - add support for templates
       see pull requests for sophomorix2


all scripts: when die (file missing), tell what file is missing 

############################################################
Janitor scripts
############################################################

check if user is in more groups of type class