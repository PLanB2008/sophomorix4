#!/usr/bin/perl -w
# This script (sophomorix-test) is maintained by Rüdiger Beck
# It is Free Software (License GPLv3)
# If you find errors, contact the author
# jeffbeck@web.de  or  jeffbeck@linuxmuster.net

# Bibliotheken
use strict;
#use Quota;
use Getopt::Long;
Getopt::Long::Configure ("bundling");
use Sophomorix::SophomorixConfig;
#use IMAP::Admin;
#use DBI;
use Net::LDAP;
use Data::Dumper;
$Data::Dumper::Indent = 1;
$Data::Dumper::Sortkeys = 1;
$Data::Dumper::Useqq = 1;
$Data::Dumper::Terse = 1; 

use Sophomorix::SophomorixBase qw(
                                 print_line
                                 print_title
                                 time_stamp_AD
                                 time_stamp_file
                                 unlock_sophomorix
                                 lock_sophomorix
                                 log_script_start
                                 log_script_end
                                 log_script_exit
                                 backup_amku_file
                                 get_passwd_charlist
                                 get_plain_password
                                 check_options
                                 config_sophomorix_read
                                 );
use Sophomorix::SophomorixSambaAD qw(
                                 AD_ou_add
                                 AD_bind_admin
                                 AD_unbind_admin
                                 AD_user_create
                                 AD_object_search
                                 AD_object_move
                                 AD_group_create
                                 AD_group_addmember
                                 AD_get_name_tokened
                                 get_forbidden_logins
                                 AD_login_test
AD_get_ou_tokened
                                 next_free_uidnumber_set
                                 next_free_uidnumber_get
                                    );




$Conf::log_level=1;
my $help=0;


# Parsen der Optionen
my $testopt=GetOptions(
           "verbose|v+" => \$Conf::log_level,
           "help|h" => \$help
          );

# Reading Configuration
my ($ldap,$root_dse) = &AD_bind_admin();
my %sophomorix_config=&config_sophomorix_read($ldap,$root_dse);

############################################################
# BEGIN: Test code goes here
############################################################

print "Start\n";

&function("Text",\%sophomorix_config);

print "The newly hash contains the stuff added to :\n";
print Dumper(%sophomorix_config);

# geht nur ohne ->
#print "$sophomorix_config{'user_file'}{'students.csv'}{HALLO}\n";

         &AD_ou_add({ldap=>$ldap,
                     root_dse=>$root_dse,
                     ou=>"UNIVERSITÄT",
                     school_token=>"uni",
                     creationdate=>"19700101000000.0Z",
                     sophomorix_config=>\%sophomorix_config,
                   });


#my $test=&AD_get_ou_tokened("TU");
#print "TEST: $test\n";
############################################################
# END: Test code goes here
############################################################

&AD_unbind_admin($ldap);

sub function {
    my ($value,$ref_sophomorix_config)=@_;
    print "Der Text: $value\n";
    print "From the hash: $ref_sophomorix_config->{'user_file'}{'students.csv'}{RT_OU_SUB_SECONDARY}\n";
    # adding something to the referenced hash: geht nur mit ->
    $ref_sophomorix_config->{'user_file'}{'students.csv'}{HALLO}="wach";
}
