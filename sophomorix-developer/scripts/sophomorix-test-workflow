#!/usr/bin/perl -w
# This script (sophomorix-test-workflow) is maintained by Rüdiger Beck
# It is Free Software (License GPLv3)
# If you find errors, contact the author
# jeffbeck@web.de  or  jeffbeck@linuxmuster.net

# Bibliotheken
use strict;
use Getopt::Long;
Getopt::Long::Configure ("bundling");
use Sophomorix::SophomorixBase qw(
                                 print_line
                                 print_title
                                 check_options
                                 );
use Sophomorix::SophomorixSambaAD qw(
                                 AD_bind_admin
                                 AD_unbind_admin
                                 AD_dns_get
                                 AD_object_search
                                    );
use Sophomorix::SophomorixTest qw(
                                 AD_object_nonexist
                                 AD_dn_nonexist
                                 AD_test_object
                                 directory_tree_test
                                 run_command
                                 AD_test_session_count
                                 ACL_test
                                 AD_user_timeupdate
                                 AD_get_samaccountname
                                 );

$Conf::log_level=1;
my $add_check=0;
my $modify_1_check=0;
my $modify_2_check=0;
my $modify_3_check=0;
my $modify_4_check=0;
my $kill_check=0;

my $add_do=0;
my $modify_1_do=0;
my $modify_2_do=0;
my $modify_3_do=0;
my $modify_4_do=0;
my $kill_do=0;

my $full=0;
my $help=0;
my $verbose_options="";

my $testopt=GetOptions(
           "help|h" => \$help,
           "verbose|v+" => \$Conf::log_level,
           "add-check" => \$add_check,
           "add-do" => \$add_do,
           "modify-1-check" => \$modify_1_check,
           "modify-2-check" => \$modify_2_check,
           "modify-3-check" => \$modify_3_check,
           "modify-4-check" => \$modify_4_check,
           "modify-1-do" => \$modify_1_do,
           "modify-2-do" => \$modify_2_do,
           "modify-3-do" => \$modify_3_do,
           "modify-4-do" => \$modify_4_do,
           "kill-check" => \$kill_check,
           "kill-do" => \$kill_do,
           "full|f" => \$full,
          );

# Prüfen, ob Optionen erkannt wurden, sonst Abbruch
&check_options($testopt);

if ($Conf::log_level==1){
    $verbose_options="";
} elsif ($Conf::log_level==2){
    $verbose_options="-v";
} elsif ($Conf::log_level==3){
    $verbose_options="-vv";
}

my ($ldap,$root_dse) = &AD_bind_admin();
my $root_dns=&AD_dns_get($root_dse);


# --help
if ($help==1) {
   # Scriptname ermitteln
   my @list = split(/\//,$0);
   my $scriptname = pop @list;
   # Befehlsbeschreibung
   print('
sophomorix-test-workflow tests sophomorix-add,sophomorix-update and sophomorix-kill.

I should run safely on an productive system. But PLEASE have a backup ready.

Options
  -h  / --help

Full automated test:

  -f, --full 
   full test (adding, modifying, killing users)

Step by step Test:

  Adding users:
      sophomorix-test-workflow --add-check
      sophomorix-test-workflow --add-do

  Work with the users:
      sophomorix-test-workflow --modify-1-check
      sophomorix-test-workflow --modify-1-do

      sophomorix-test-workflow --modify-2-check
      sophomorix-test-workflow --modify-2-do

      sophomorix-test-workflow --modify-3-check
      sophomorix-test-workflow --modify-3-do

      sophomorix-test-workflow --modify-4-check
      sophomorix-test-workflow --modify-4-do

  Kill the added users:
      sophomorix-test-workflow --kill-check
      sophomorix-test-workflow --kill-do

');
   print "\n";
   exit;
}




############################################################
# Check preliminaries
############################################################

&run_command("mkdir -p $DevelConf::path_result");


# --full
if ($full==1){
    $add_check=1;
    $modify_1_check=1;
    $modify_2_check=1;
    $modify_3_check=1;
    $modify_4_check=1;
    $kill_check=1;
    $add_do=1;
    $modify_1_do=1;
    $modify_2_do=1;
    $modify_3_do=1;
    $modify_4_do=1;
    $kill_do=1;
}


############################################################
# Adding users --add
############################################################
if ($add_check==1){
    my $command_add="sophomorix-check ".
                "--injectline \"bsz.teachers.csv:teachers;Kopernikus;Nikolaus;19.02.1973;koperni99\" ".
                "--injectline \"bsz.teachers.csv:teachers;Darwin;Charles;12.02.2009;darwi99\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Mendel;Gregor;01.01.2000;\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Wallace;Alfred Russel;01.01.2000;\" ".
                "--injectline \"teachers.csv:teachers;Stefánsson;Ólafur Indriði;03.07.1973;olinst99\" ".
                "--injectline \"teachers.csv:teachers;Kristinsson;Rúnar;05.09.1969;rukri99\" ".
                "--injectline \"teachers.csv:teachers;Skúlason;Ari Freyr;14.05.1987;skula99\" ".
                "--injectline \"teachers.csv:teachers;Bjarnason;Theódór Elmar;04.03.1987;bjarna99\" ".
                "--injectline \"students.csv:7a;Halldórsson;Hannes Þór;27.04.1984;\" ".
                "--injectline \"students.csv:7a;Gunnarsson;Aron;22.04.1989;\" ".
                "--injectline \"students.csv:7a;Sigurðsson;Ragnar;19.06.1986;\" ".
                "--injectline \"students.csv:7a;Sigurðsson;Gylfi Þór;08.09.1989;\" ";
    &run_command($command_add);
}
############################################################
if ($add_do==1){
    &run_command("sophomorix-add");
    &run_command("sophomorix-update");
    &run_command("sophomorix-kill");

    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });
    my ($sigurdgy,$sigurdgy_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Gylfi Þór",
                                birthdate=>"08.09.1989",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";
    print "U: $sigurdgy\n";

    # $mendelgr
    my $dn_mendelgr="CN=".$mendelgr.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_mendelgr,
                   #####
                   displayName=>"Gregor Mendel",
                   givenName=>"Gregor",
                   name=>$mendelgr,
                   sAMAccountname=>$mendelgr,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$mendelgr,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$mendelgr,
                   sn=>"Mendel",
                   userPrincipalName => $mendelgr."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gregor",
                   sophomorixSurnameASCII  => "Mendel",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $wallacal
    my $dn_wallacal="CN=".$wallacal.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_wallacal,
                   #####
                   displayName=>"Alfred Russel Wallace",
                   givenName=>"Alfred Russel",
                   name=>$wallacal,
                   sAMAccountname=>$wallacal,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$wallacal,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$wallacal,
                   sn=>"Wallace",
                   userPrincipalName => $wallacal."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Alfred Russel",
                   sophomorixSurnameASCII  => "Wallace",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $halldoha
    my $dn_halldoha="CN=".$halldoha.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_halldoha,
                   #####
                   displayName=>"Hannes Þór Halldórsson",
                   givenName=>"Hannes Þór",
                   name=>$halldoha,
                   sAMAccountname=>$halldoha,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$halldoha,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$halldoha,
                   sn=>"Halldórsson",
                   userPrincipalName => $halldoha."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Hannes Thor",
                   sophomorixSurnameASCII  => "Halldorsson",
                   sophomorixBirthdate  => "27.04.1984",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $gunnarar
    my $dn_gunnarar="CN=".$gunnarar.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_gunnarar,
                   #####
                   displayName=>"Aron Gunnarsson",
                   givenName=>"Aron",
                   name=>$gunnarar,
                   sAMAccountname=>$gunnarar,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$gunnarar,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$gunnarar,
                   sn=>"Gunnarsson",
                   userPrincipalName => $gunnarar."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Aron",
                   sophomorixSurnameASCII  => "Gunnarsson",
                   sophomorixBirthdate  => "22.04.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdra
    my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdra,
                   #####
                   displayName=>"Ragnar Sigurðsson",
                   givenName=>"Ragnar",
                   name=>$sigurdra,
                   sAMAccountname=>$sigurdra,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdra,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdra,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdra."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Ragnar",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "19.06.1986",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdgy
    my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdgy,
                   #####
                   displayName=>"Gylfi Þór Sigurðsson",
                   givenName=>"Gylfi Þór",
                   name=>$sigurdgy,
                   sAMAccountname=>$sigurdgy,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdgy,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdgy,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdgy."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gylfi Thor",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "08.09.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    ##### Testing the users class
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=7a,OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"7a",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"7a",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$halldoha."|".$gunnarar."|".$sigurdra."|".$sigurdgy,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "students",
                   member => $halldoha."|".$gunnarar."|".$sigurdra."|".$sigurdgy,
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-m3kk3t,OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-m3kk3t",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"bsz-m3kk3t",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$mendelgr."|".$wallacal,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "bsz-students",
                   member => $mendelgr."|".$wallacal,
                  });
    ##### Testing the users ou-students group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=students,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-students",
                   member => "7a",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-students,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-students",
                   member => "bsz-m3kk3t",
                  });

    # koperni99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=koperni99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Nikolaus Kopernikus",
                   givenName=>"Nikolaus",
                   name=>"koperni99",
                   sAMAccountname=>"koperni99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\koperni99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/koperni99",
                   sn=>"Kopernikus",
                   userPrincipalName => "koperni99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Nikolaus",
                   sophomorixSurnameASCII  => "Kopernikus",
                   sophomorixBirthdate  => "19.02.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # darwi99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=darwi99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Charles Darwin",
                   givenName=>"Charles",
                   name=>"darwi99",
                   sAMAccountname=>"darwi99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\darwi99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/darwi99",
                   sn=>"Darwin",
                   userPrincipalName => "darwi99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Charles",
                   sophomorixSurnameASCII  => "Darwin",
                   sophomorixBirthdate  => "12.02.2009",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # olinst99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=olinst99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ólafur Indriði Stefánsson",
                   givenName=>"Ólafur Indriði",
                   name=>"olinst99",
                   sAMAccountname=>"olinst99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\olinst99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/olinst99",
                   sn=>"Stefánsson",
                   userPrincipalName => "olinst99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Olafur Indridi",
                   sophomorixSurnameASCII  => "Stefansson",
                   sophomorixBirthdate  => "03.07.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });

    # rukri99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=rukri99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Rúnar Kristinsson",
                   givenName=>"Rúnar",
                   name=>"rukri99",
                   sAMAccountname=>"rukri99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\rukri99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/rukri99",
                   sn=>"Kristinsson",
                   userPrincipalName => "rukri99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Runar",
                   sophomorixSurnameASCII  => "Kristinsson",
                   sophomorixBirthdate  => "05.09.1969",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # skula99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ari Freyr Skúlason",
                   givenName=>"Ari Freyr",
                   name=>"skula99",
                   sAMAccountname=>"skula99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\skula99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/skula99",
                   sn=>"Skúlason",
                   userPrincipalName => "skula99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Ari Freyr",
                   sophomorixSurnameASCII  => "Skulason",
                   sophomorixBirthdate  => "14.05.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # bjarna99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Theódór Elmar Bjarnason",
                   givenName=>"Theódór Elmar",
                   name=>"bjarna99",
                   sAMAccountname=>"bjarna99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\bjarna99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/bjarna99",
                   sn=>"Bjarnason",
                   userPrincipalName => "bjarna99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Theodor Elmar",
                   sophomorixSurnameASCII  => "Bjarnason",
                   sophomorixBirthdate  => "04.03.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    ##### Testing the users ou-teachers group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=teachers,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"rukri99|olinst99|skula99|bjarna99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-teachers",
                   member => "rukri99|olinst99|skula99|bjarna99",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-teachers,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"koperni99|darwi99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-teachers",
                   member => "koperni99|darwi99",
                  });
}




############################################################
# --modify-1-check --modify-1-do
############################################################
if ($modify_1_check==1){
    my $command_modify_1="sophomorix-check ".
                "--injectline \"bsz.teachers.csv:teachers;Kopernikus;Nikolaus;19.02.1973;koperni99\" ".
                "--injectline \"bsz.teachers.csv:teachers;Darwin;Charles;12.02.2009;darwi99\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Mendel;Gregor;01.01.2000;\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Wallace;Alfred Russel;01.01.2000;\" ";
#                "--injectline \"teachers.csv:teachers;Stefánsson;Ólafur Indriði;03.07.1973;olinst99\" ".   # removed
#                "--injectline \"teachers.csv:teachers;Kristinsson;Rúnar;05.09.1969;rukri99\" ".            # removed
#                "--injectline \"teachers.csv:teachers;Skúlason;Ari Freyr;14.05.1987;skula99\" ".           # removed
#                "--injectline \"teachers.csv:teachers;Bjarnason;Theódór Elmar;04.03.1987;bjarna99\" ".     # removed
#                "--injectline \"students.csv:7a;Halldórsson;Hannes Þór;27.04.1984;\" ".                    # removed
#                "--injectline \"students.csv:7a;Gunnarsson;Aron;22.04.1989;\" ".                           # removed
#                "--injectline \"students.csv:7a;Sigurðsson;Ragnar;19.06.1986;\" ";                         # removed
#                "--injectline \"students.csv:7a;Sigurðsson;Gylfi Þór;08.09.1989;\" ".""                    # removed

    &run_command($command_modify_1);
}
############################################################
if ($modify_1_do==1){
    &run_command("sophomorix-add");
    &run_command("sophomorix-update");
    &run_command("sophomorix-kill");

    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });
    my ($sigurdgy,$sigurdgy_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Gylfi Þór",
                                birthdate=>"08.09.1989",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";
    print "U: $sigurdgy\n";

    # $mendelgr
    my $dn_mendelgr="CN=".$mendelgr.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_mendelgr,
                   #####
                   displayName=>"Gregor Mendel",
                   givenName=>"Gregor",
                   name=>$mendelgr,
                   sAMAccountname=>$mendelgr,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$mendelgr,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$mendelgr,
                   sn=>"Mendel",
                   userPrincipalName => $mendelgr."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gregor",
                   sophomorixSurnameASCII  => "Mendel",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $wallacal
    my $dn_wallacal="CN=".$wallacal.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_wallacal,
                   #####
                   displayName=>"Alfred Russel Wallace",
                   givenName=>"Alfred Russel",
                   name=>$wallacal,
                   sAMAccountname=>$wallacal,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$wallacal,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$wallacal,
                   sn=>"Wallace",
                   userPrincipalName => $wallacal."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Alfred Russel",
                   sophomorixSurnameASCII  => "Wallace",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $halldoha
    my $dn_halldoha="CN=".$halldoha.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_halldoha,
                   #####
                   displayName=>"Hannes Þór Halldórsson",
                   givenName=>"Hannes Þór",
                   name=>$halldoha,
                   sAMAccountname=>$halldoha,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$halldoha,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$halldoha,
                   sn=>"Halldórsson",
                   userPrincipalName => $halldoha."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Hannes Thor",
                   sophomorixSurnameASCII  => "Halldorsson",
                   sophomorixBirthdate  => "27.04.1984",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "T",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $gunnarar
    my $dn_gunnarar="CN=".$gunnarar.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_gunnarar,
                   #####
                   displayName=>"Aron Gunnarsson",
                   givenName=>"Aron",
                   name=>$gunnarar,
                   sAMAccountname=>$gunnarar,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$gunnarar,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$gunnarar,
                   sn=>"Gunnarsson",
                   userPrincipalName => $gunnarar."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Aron",
                   sophomorixSurnameASCII  => "Gunnarsson",
                   sophomorixBirthdate  => "22.04.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "T",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdra
    my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdra,
                   #####
                   displayName=>"Ragnar Sigurðsson",
                   givenName=>"Ragnar",
                   name=>$sigurdra,
                   sAMAccountname=>$sigurdra,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdra,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdra,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdra."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Ragnar",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "19.06.1986",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "T",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdgy
    my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdgy,
                   #####
                   displayName=>"Gylfi Þór Sigurðsson",
                   givenName=>"Gylfi Þór",
                   name=>$sigurdgy,
                   sAMAccountname=>$sigurdgy,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdgy,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdgy,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdgy."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gylfi Thor",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "08.09.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "T",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    ##### Testing the users class
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=7a,OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"7a",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"7a",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$halldoha."|".$gunnarar."|".$sigurdra."|".$sigurdgy,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "students",
                   member => $halldoha."|".$gunnarar."|".$sigurdra."|".$sigurdgy,
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-m3kk3t,OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-m3kk3t",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"bsz-m3kk3t",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$mendelgr."|".$wallacal,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "bsz-students",
                   member => $mendelgr."|".$wallacal,
                  });
    ##### Testing the users ou-students group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=students,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-students",
                   member => "7a",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-students,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-students",
                   member => "bsz-m3kk3t",
                  });


    # koperni99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=koperni99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Nikolaus Kopernikus",
                   givenName=>"Nikolaus",
                   name=>"koperni99",
                   sAMAccountname=>"koperni99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\koperni99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/koperni99",
                   sn=>"Kopernikus",
                   userPrincipalName => "koperni99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Nikolaus",
                   sophomorixSurnameASCII  => "Kopernikus",
                   sophomorixBirthdate  => "19.02.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # darwi99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=darwi99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Charles Darwin",
                   givenName=>"Charles",
                   name=>"darwi99",
                   sAMAccountname=>"darwi99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\darwi99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/darwi99",
                   sn=>"Darwin",
                   userPrincipalName => "darwi99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Charles",
                   sophomorixSurnameASCII  => "Darwin",
                   sophomorixBirthdate  => "12.02.2009",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # olinst99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=olinst99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ólafur Indriði Stefánsson",
                   givenName=>"Ólafur Indriði",
                   name=>"olinst99",
                   sAMAccountname=>"olinst99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\olinst99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/olinst99",
                   sn=>"Stefánsson",
                   userPrincipalName => "olinst99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Olafur Indridi",
                   sophomorixSurnameASCII  => "Stefansson",
                   sophomorixBirthdate  => "03.07.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "T",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });

    # rukri99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=rukri99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Rúnar Kristinsson",
                   givenName=>"Rúnar",
                   name=>"rukri99",
                   sAMAccountname=>"rukri99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\rukri99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/rukri99",
                   sn=>"Kristinsson",
                   userPrincipalName => "rukri99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Runar",
                   sophomorixSurnameASCII  => "Kristinsson",
                   sophomorixBirthdate  => "05.09.1969",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "T",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # skula99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ari Freyr Skúlason",
                   givenName=>"Ari Freyr",
                   name=>"skula99",
                   sAMAccountname=>"skula99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\skula99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/skula99",
                   sn=>"Skúlason",
                   userPrincipalName => "skula99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Ari Freyr",
                   sophomorixSurnameASCII  => "Skulason",
                   sophomorixBirthdate  => "14.05.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "T",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # bjarna99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Theódór Elmar Bjarnason",
                   givenName=>"Theódór Elmar",
                   name=>"bjarna99",
                   sAMAccountname=>"bjarna99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\bjarna99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/bjarna99",
                   sn=>"Bjarnason",
                   userPrincipalName => "bjarna99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Theodor Elmar",
                   sophomorixSurnameASCII  => "Bjarnason",
                   sophomorixBirthdate  => "04.03.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "T",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    ##### Testing the users ou-teachers group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=teachers,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"rukri99|olinst99|skula99|bjarna99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-teachers",
                   member => "rukri99|olinst99|skula99|bjarna99",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-teachers,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"koperni99|darwi99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-teachers",
                   member => "koperni99|darwi99",
                  });
}

############################################################
# --modify-2-check  --modify-2-do
############################################################
if ($modify_2_check==1){
    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });
    my ($sigurdgy,$sigurdgy_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Gylfi Þór",
                                birthdate=>"08.09.1989",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";
    print "U: $sigurdgy\n";

    my $dn_gunnarar="CN=".$gunnarar.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_gunnarar,"20170101000001.0Z","---");
    my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_sigurdra,"20170101000001.0Z","---");
    my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_sigurdgy,"20170101000001.0Z","---");

    my $dn_rukri99="CN=rukri99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_rukri99,"20170101000002.0Z","---");
    my $dn_skula99="CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_skula99,"20170101000002.0Z","---");
    my $dn_bjarna99="CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_bjarna99,"20170101000002.0Z","---");

    my $command_modify_2="sophomorix-check ".
                "--injectline \"bsz.teachers.csv:teachers;Kopernikus;Nikolaus;19.02.1973;koperni99\" ".
                "--injectline \"bsz.teachers.csv:teachers;Darwin;Charles;12.02.2009;darwi99\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Mendel;Gregor;01.01.2000;\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Wallace;Alfred Russel;01.01.2000;\" ".
                "--injectline \"teachers.csv:teachers;Stefánsson;Ólafur Indriði;03.07.1973;olinst99\" ".    # back
#                "--injectline \"teachers.csv:teachers;Kristinsson;Rúnar;05.09.1969;rukri99\" ".            # removed
#                "--injectline \"teachers.csv:teachers;Skúlason;Ari Freyr;14.05.1987;skula99\" ".           # removed
#                "--injectline \"teachers.csv:teachers;Bjarnason;Theódór Elmar;04.03.1987;bjarna99\" ".     # removed
                "--injectline \"students.csv:7a;Halldórsson;Hannes Þór;27.04.1984;\" --dump-matches -j";                     # back
#                "--injectline \"students.csv:7a;Gunnarsson;Aron;22.04.1989;\" ".                           # removed
#                "--injectline \"students.csv:7a;Sigurðsson;Ragnar;19.06.1986;\" ";                         # removed
#                "--injectline \"students.csv:7a;Sigurðsson;Gylfi Þór;08.09.1989;\" ".""                    # removed

    &run_command($command_modify_2);
}
############################################################
if ($modify_2_do==1){
    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });
    my ($sigurdgy,$sigurdgy_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Gylfi Þór",
                                birthdate=>"08.09.1989",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";
    print "U: $sigurdgy\n";

    my $dn_gunnarar="CN=".$gunnarar.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;

    my $dn_rukri99="CN=rukri99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;
    my $dn_skula99="CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;
    my $dn_bjarna99="CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;

    &run_command("sophomorix-add");
    &run_command("sophomorix-update");
    &run_command("sophomorix-kill");

    # $mendelgr
    my $dn_mendelgr="CN=".$mendelgr.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_mendelgr,
                   #####
                   displayName=>"Gregor Mendel",
                   givenName=>"Gregor",
                   name=>$mendelgr,
                   sAMAccountname=>$mendelgr,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$mendelgr,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$mendelgr,
                   sn=>"Mendel",
                   userPrincipalName => $mendelgr."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gregor",
                   sophomorixSurnameASCII  => "Mendel",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $wallacal
    my $dn_wallacal="CN=".$wallacal.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_wallacal,
                   #####
                   displayName=>"Alfred Russel Wallace",
                   givenName=>"Alfred Russel",
                   name=>$wallacal,
                   sAMAccountname=>$wallacal,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$wallacal,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$wallacal,
                   sn=>"Wallace",
                   userPrincipalName => $wallacal."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Alfred Russel",
                   sophomorixSurnameASCII  => "Wallace",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $halldoha
    my $dn_halldoha="CN=".$halldoha.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_halldoha,
                   #####
                   displayName=>"Hannes Þór Halldórsson",
                   givenName=>"Hannes Þór",
                   name=>$halldoha,
                   sAMAccountname=>$halldoha,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$halldoha,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$halldoha,
                   sn=>"Halldórsson",
                   userPrincipalName => $halldoha."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Hannes Thor",
                   sophomorixSurnameASCII  => "Halldorsson",
                   sophomorixBirthdate  => "27.04.1984",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $gunnarar
    # my $dn_gunnarar="CN=".$gunnarar.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_gunnarar,
                   #####
                   displayName=>"Aron Gunnarsson",
                   givenName=>"Aron",
                   name=>$gunnarar,
                   sAMAccountname=>$gunnarar,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$gunnarar,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$gunnarar,
                   sn=>"Gunnarsson",
                   userPrincipalName => $gunnarar."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Aron",
                   sophomorixSurnameASCII  => "Gunnarsson",
                   sophomorixBirthdate  => "22.04.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "D",
                   sophomorixUnid => "---",
                   userAccountControl => "514",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdra
    # my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdra,
                   #####
                   displayName=>"Ragnar Sigurðsson",
                   givenName=>"Ragnar",
                   name=>$sigurdra,
                   sAMAccountname=>$sigurdra,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdra,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdra,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdra."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Ragnar",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "19.06.1986",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "D",
                   sophomorixUnid => "---",
                   userAccountControl => "514",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdgy
    #my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdgy,
                   #####
                   displayName=>"Gylfi Þór Sigurðsson",
                   givenName=>"Gylfi Þór",
                   name=>$sigurdgy,
                   sAMAccountname=>$sigurdgy,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdgy,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdgy,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdgy."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gylfi Thor",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "08.09.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "D",
                   sophomorixUnid => "---",
                   userAccountControl => "514",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    ##### Testing the users class
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=7a,OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"7a",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"7a",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$halldoha."|".$gunnarar."|".$sigurdra."|".$sigurdgy,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "students",
                   member => $halldoha."|".$gunnarar."|".$sigurdra."|".$sigurdgy,
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-m3kk3t,OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-m3kk3t",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"bsz-m3kk3t",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$mendelgr."|".$wallacal,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "bsz-students",
                   member => $mendelgr."|".$wallacal,
                  });
    ##### Testing the users ou-students group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=students,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-students",
                   member => "7a",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-students,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-students",
                   member => "bsz-m3kk3t",
                  });


    # koperni99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=koperni99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Nikolaus Kopernikus",
                   givenName=>"Nikolaus",
                   name=>"koperni99",
                   sAMAccountname=>"koperni99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\koperni99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/koperni99",
                   sn=>"Kopernikus",
                   userPrincipalName => "koperni99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Nikolaus",
                   sophomorixSurnameASCII  => "Kopernikus",
                   sophomorixBirthdate  => "19.02.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # darwi99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=darwi99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Charles Darwin",
                   givenName=>"Charles",
                   name=>"darwi99",
                   sAMAccountname=>"darwi99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\darwi99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/darwi99",
                   sn=>"Darwin",
                   userPrincipalName => "darwi99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Charles",
                   sophomorixSurnameASCII  => "Darwin",
                   sophomorixBirthdate  => "12.02.2009",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # olinst99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=olinst99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ólafur Indriði Stefánsson",
                   givenName=>"Ólafur Indriði",
                   name=>"olinst99",
                   sAMAccountname=>"olinst99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\olinst99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/olinst99",
                   sn=>"Stefánsson",
                   userPrincipalName => "olinst99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Olafur Indridi",
                   sophomorixSurnameASCII  => "Stefansson",
                   sophomorixBirthdate  => "03.07.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });

    # rukri99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=rukri99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Rúnar Kristinsson",
                   givenName=>"Rúnar",
                   name=>"rukri99",
                   sAMAccountname=>"rukri99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\rukri99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/rukri99",
                   sn=>"Kristinsson",
                   userPrincipalName => "rukri99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Runar",
                   sophomorixSurnameASCII  => "Kristinsson",
                   sophomorixBirthdate  => "05.09.1969",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "D",
                   userAccountControl => "514",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # skula99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ari Freyr Skúlason",
                   givenName=>"Ari Freyr",
                   name=>"skula99",
                   sAMAccountname=>"skula99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\skula99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/skula99",
                   sn=>"Skúlason",
                   userPrincipalName => "skula99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Ari Freyr",
                   sophomorixSurnameASCII  => "Skulason",
                   sophomorixBirthdate  => "14.05.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "D",
                   userAccountControl => "514",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # bjarna99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Theódór Elmar Bjarnason",
                   givenName=>"Theódór Elmar",
                   name=>"bjarna99",
                   sAMAccountname=>"bjarna99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\bjarna99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/bjarna99",
                   sn=>"Bjarnason",
                   userPrincipalName => "bjarna99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Theodor Elmar",
                   sophomorixSurnameASCII  => "Bjarnason",
                   sophomorixBirthdate  => "04.03.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "D",
                   userAccountControl => "514",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    ##### Testing the users ou-teachers group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=teachers,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"rukri99|olinst99|skula99|bjarna99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-teachers",
                   member => "rukri99|olinst99|skula99|bjarna99",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-teachers,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"koperni99|darwi99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-teachers",
                   member => "koperni99|darwi99",
                  });
}



############################################################
# --modify-3-check --modify-3-do
############################################################
if ($modify_3_check==1){
    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });

    my ($sigurdgy,$sigurdgy_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Gylfi Þór",
                                birthdate=>"08.09.1989",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";
    print "U: $sigurdgy\n";

    my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_sigurdgy,"20160101000001.0Z","20170101000001.0Z");
    my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_sigurdra,"20160101000001.0Z","20170101000001.0Z");

    my $dn_skula99="CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_skula99,"20160101000002.0Z","20170101000002.0Z");
    my $dn_bjarna99="CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_user_timeupdate($ldap,$root_dse,$dn_bjarna99,"20160101000002.0Z","20170101000002.0Z");

    my $command_modify_3="sophomorix-check ".
                "--injectline \"bsz.teachers.csv:teachers;Kopernikus;Nikolaus;19.02.1973;koperni99\" ".
                "--injectline \"bsz.teachers.csv:teachers;Darwin;Charles;12.02.2009;darwi99\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Mendel;Gregor;01.01.2000;\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Wallace;Alfred Russel;01.01.2000;\" ".
                "--injectline \"teachers.csv:teachers;Stefánsson;Ólafur Indriði;03.07.1973;olinst99\" ".
                "--injectline \"teachers.csv:teachers;Kristinsson;Rúnar;05.09.1969;rukri99\" ".             # back
#                "--injectline \"teachers.csv:teachers;Skúlason;Ari Freyr;14.05.1987;skula99\" ".           # removed
#                "--injectline \"teachers.csv:teachers;Bjarnason;Theódór Elmar;04.03.1987;bjarna99\" ".     # removed
                "--injectline \"students.csv:7a;Halldórsson;Hannes Þór;27.04.1984;\" ".
                "--injectline \"students.csv:7a;Gunnarsson;Aron;22.04.1989;\" ";                            # back
#                "--injectline \"students.csv:7a;Sigurðsson;Ragnar;19.06.1986;\" ";                         # removed
#                "--injectline \"students.csv:7a;Sigurðsson;Gylfi Þór;08.09.1989;\" ".""                    # removed

    &run_command($command_modify_3);
}
############################################################
if ($modify_3_do==1){
    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });

    my ($sigurdgy,$sigurdgy_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Gylfi Þór",
                                birthdate=>"08.09.1989",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";
    print "U: $sigurdgy\n";

    my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    my $dn_skula99="CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;
    my $dn_bjarna99="CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse;

    &run_command("sophomorix-add");
    &run_command("sophomorix-update");
    # do not kill the users now (first test if they have status R)

    # $mendelgr
    my $dn_mendelgr="CN=".$mendelgr.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_mendelgr,
                   #####
                   displayName=>"Gregor Mendel",
                   givenName=>"Gregor",
                   name=>$mendelgr,
                   sAMAccountname=>$mendelgr,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$mendelgr,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$mendelgr,
                   sn=>"Mendel",
                   userPrincipalName => $mendelgr."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gregor",
                   sophomorixSurnameASCII  => "Mendel",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $wallacal
    my $dn_wallacal="CN=".$wallacal.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_wallacal,
                   #####
                   displayName=>"Alfred Russel Wallace",
                   givenName=>"Alfred Russel",
                   name=>$wallacal,
                   sAMAccountname=>$wallacal,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$wallacal,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$wallacal,
                   sn=>"Wallace",
                   userPrincipalName => $wallacal."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Alfred Russel",
                   sophomorixSurnameASCII  => "Wallace",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $halldoha
    my $dn_halldoha="CN=".$halldoha.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_halldoha,
                   #####
                   displayName=>"Hannes Þór Halldórsson",
                   givenName=>"Hannes Þór",
                   name=>$halldoha,
                   sAMAccountname=>$halldoha,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$halldoha,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$halldoha,
                   sn=>"Halldórsson",
                   userPrincipalName => $halldoha."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Hannes Thor",
                   sophomorixSurnameASCII  => "Halldorsson",
                   sophomorixBirthdate  => "27.04.1984",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $gunnarar
    my $dn_gunnarar="CN=".$gunnarar.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_gunnarar,
                   #####
                   displayName=>"Aron Gunnarsson",
                   givenName=>"Aron",
                   name=>$gunnarar,
                   sAMAccountname=>$gunnarar,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$gunnarar,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$gunnarar,
                   sn=>"Gunnarsson",
                   userPrincipalName => $gunnarar."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Aron",
                   sophomorixSurnameASCII  => "Gunnarsson",
                   sophomorixBirthdate  => "22.04.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdra
    # my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdra,
                   #####
                   displayName=>"Ragnar Sigurðsson",
                   givenName=>"Ragnar",
                   name=>$sigurdra,
                   sAMAccountname=>$sigurdra,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdra,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdra,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdra."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Ragnar",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "19.06.1986",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "R",
                   sophomorixUnid => "---",
                   userAccountControl => "514",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdgy
    #my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdgy,
                   #####
                   displayName=>"Gylfi Þór Sigurðsson",
                   givenName=>"Gylfi Þór",
                   name=>$sigurdgy,
                   sAMAccountname=>$sigurdgy,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdgy,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdgy,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdgy."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gylfi Thor",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "08.09.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "R",
                   sophomorixUnid => "---",
                   userAccountControl => "514",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    ##### Testing the users class
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=7a,OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"7a",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"7a",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$halldoha."|".$gunnarar."|".$sigurdra."|".$sigurdgy,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "students",
                   member => $halldoha."|".$gunnarar."|".$sigurdra."|".$sigurdgy,
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-m3kk3t,OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-m3kk3t",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"bsz-m3kk3t",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$mendelgr."|".$wallacal,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "bsz-students",
                   member => $mendelgr."|".$wallacal,
                  });
    ##### Testing the users ou-students group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=students,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-students",
                   member => "7a",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-students,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-students",
                   member => "bsz-m3kk3t",
                  });


    # koperni99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=koperni99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Nikolaus Kopernikus",
                   givenName=>"Nikolaus",
                   name=>"koperni99",
                   sAMAccountname=>"koperni99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\koperni99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/koperni99",
                   sn=>"Kopernikus",
                   userPrincipalName => "koperni99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Nikolaus",
                   sophomorixSurnameASCII  => "Kopernikus",
                   sophomorixBirthdate  => "19.02.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # darwi99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=darwi99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Charles Darwin",
                   givenName=>"Charles",
                   name=>"darwi99",
                   sAMAccountname=>"darwi99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\darwi99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/darwi99",
                   sn=>"Darwin",
                   userPrincipalName => "darwi99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Charles",
                   sophomorixSurnameASCII  => "Darwin",
                   sophomorixBirthdate  => "12.02.2009",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # olinst99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=olinst99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ólafur Indriði Stefánsson",
                   givenName=>"Ólafur Indriði",
                   name=>"olinst99",
                   sAMAccountname=>"olinst99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\olinst99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/olinst99",
                   sn=>"Stefánsson",
                   userPrincipalName => "olinst99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Olafur Indridi",
                   sophomorixSurnameASCII  => "Stefansson",
                   sophomorixBirthdate  => "03.07.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });

    # rukri99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=rukri99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Rúnar Kristinsson",
                   givenName=>"Rúnar",
                   name=>"rukri99",
                   sAMAccountname=>"rukri99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\rukri99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/rukri99",
                   sn=>"Kristinsson",
                   userPrincipalName => "rukri99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Runar",
                   sophomorixSurnameASCII  => "Kristinsson",
                   sophomorixBirthdate  => "05.09.1969",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # skula99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ari Freyr Skúlason",
                   givenName=>"Ari Freyr",
                   name=>"skula99",
                   sAMAccountname=>"skula99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\skula99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/skula99",
                   sn=>"Skúlason",
                   userPrincipalName => "skula99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Ari Freyr",
                   sophomorixSurnameASCII  => "Skulason",
                   sophomorixBirthdate  => "14.05.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "R",
                   userAccountControl => "514",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # bjarna99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Theódór Elmar Bjarnason",
                   givenName=>"Theódór Elmar",
                   name=>"bjarna99",
                   sAMAccountname=>"bjarna99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\bjarna99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/bjarna99",
                   sn=>"Bjarnason",
                   userPrincipalName => "bjarna99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Theodor Elmar",
                   sophomorixSurnameASCII  => "Bjarnason",
                   sophomorixBirthdate  => "04.03.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "exists",
                   sophomorixDeactivationDate => "exists",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "R",
                   userAccountControl => "514",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    ##### Testing the users ou-teachers group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=teachers,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"rukri99|olinst99|skula99|bjarna99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-teachers",
                   member => "rukri99|olinst99|skula99|bjarna99",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-teachers,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"koperni99|darwi99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-teachers",
                   member => "koperni99|darwi99",
                  });
}



############################################################
# --modify-4-check --modify-4-do
############################################################
if ($modify_4_check==1){
    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });

    my ($sigurdgy,$sigurdgy_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Gylfi Þór",
                                birthdate=>"08.09.1989",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";
    print "U: $sigurdgy\n";

    my $command_modify_4="sophomorix-check ".
                "--injectline \"bsz.teachers.csv:teachers;Kopernikus;Nikolaus;19.02.1973;koperni99\" ".
                "--injectline \"bsz.teachers.csv:teachers;Darwin;Charles;12.02.2009;darwi99\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Mendel;Gregor;01.01.2000;\" ".
                "--injectline \"bsz.students.csv:m3KK3T;Wallace;Alfred Russel;01.01.2000;\" ".
                "--injectline \"teachers.csv:teachers;Stefánsson;Ólafur Indriði;03.07.1973;olinst99\" ".
                "--injectline \"teachers.csv:teachers;Kristinsson;Rúnar;05.09.1969;rukri99\" ".             # back
                "--injectline \"teachers.csv:teachers;Skúlason;Ari Freyr;14.05.1987;skula99\" ".            # back
#                "--injectline \"teachers.csv:teachers;Bjarnason;Theódór Elmar;04.03.1987;bjarna99\" ".     # removed
                "--injectline \"students.csv:7a;Halldórsson;Hannes Þór;27.04.1984;\" ".
                "--injectline \"students.csv:7a;Gunnarsson;Aron;22.04.1989;\" ".                            # back
                "--injectline \"students.csv:7a;Sigurðsson;Ragnar;19.06.1986;\" ";                          # back
#                "--injectline \"students.csv:7a;Sigurðsson;Gylfi Þór;08.09.1989;\" ".""                    # removed
    ############################################################
    # kill the users, that can be killed and test again
    ############################################################
    &run_command($command_modify_4);
}
############################################################
if ($modify_4_do==1){
    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });

    my ($sigurdgy,$sigurdgy_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Gylfi Þór",
                                birthdate=>"08.09.1989",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";
    print "U: $sigurdgy\n";

    &run_command("sophomorix-add");
    &run_command("sophomorix-update");
    &run_command("sophomorix-kill");

    # $mendelgr
    my $dn_mendelgr="CN=".$mendelgr.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_mendelgr,
                   #####
                   displayName=>"Gregor Mendel",
                   givenName=>"Gregor",
                   name=>$mendelgr,
                   sAMAccountname=>$mendelgr,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$mendelgr,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$mendelgr,
                   sn=>"Mendel",
                   userPrincipalName => $mendelgr."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Gregor",
                   sophomorixSurnameASCII  => "Mendel",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $wallacal
    my $dn_wallacal="CN=".$wallacal.",OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_wallacal,
                   #####
                   displayName=>"Alfred Russel Wallace",
                   givenName=>"Alfred Russel",
                   name=>$wallacal,
                   sAMAccountname=>$wallacal,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\students\\m3kk3t\\homes\\".$wallacal,
                   unixHomeDirectory=>"/srv/samba/schools/bsz/students/m3kk3t/homes/".$wallacal,
                   sn=>"Wallace",
                   userPrincipalName => $wallacal."@".$root_dns,
                   sophomorixAdminClass => "bsz-m3kk3t",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Alfred Russel",
                   sophomorixSurnameASCII  => "Wallace",
                   sophomorixBirthdate  => "01.01.2000",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-m3kk3t|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });
    # $halldoha
    my $dn_halldoha="CN=".$halldoha.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_halldoha,
                   #####
                   displayName=>"Hannes Þór Halldórsson",
                   givenName=>"Hannes Þór",
                   name=>$halldoha,
                   sAMAccountname=>$halldoha,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$halldoha,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$halldoha,
                   sn=>"Halldórsson",
                   userPrincipalName => $halldoha."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Hannes Thor",
                   sophomorixSurnameASCII  => "Halldorsson",
                   sophomorixBirthdate  => "27.04.1984",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $gunnarar
    my $dn_gunnarar="CN=".$gunnarar.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_gunnarar,
                   #####
                   displayName=>"Aron Gunnarsson",
                   givenName=>"Aron",
                   name=>$gunnarar,
                   sAMAccountname=>$gunnarar,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$gunnarar,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$gunnarar,
                   sn=>"Gunnarsson",
                   userPrincipalName => $gunnarar."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Aron",
                   sophomorixSurnameASCII  => "Gunnarsson",
                   sophomorixBirthdate  => "22.04.1989",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdra
    my $dn_sigurdra="CN=".$sigurdra.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
    &AD_test_object({ldap=>$ldap,
                   dn=>$dn_sigurdra,
                   #####
                   displayName=>"Ragnar Sigurðsson",
                   givenName=>"Ragnar",
                   name=>$sigurdra,
                   sAMAccountname=>$sigurdra,
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdra,
                   unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdra,
                   sn=>"Sigurðsson",
                   userPrincipalName => $sigurdra."@".$root_dns,
                   sophomorixAdminClass => "7a",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "Muster!",
                   sophomorixFirstnameASCII => "Ragnar",
                   sophomorixSurnameASCII  => "Sigurdsson",
                   sophomorixBirthdate  => "19.06.1986",
                   sophomorixRole => "student",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "7a|wifi|internet|webfilter|intranet|printing",
                  });
    # $sigurdgy must be killed by now
    &AD_object_nonexist($ldap,$root_dse,"user",$sigurdgy);

#     my $dn_sigurdgy="CN=".$sigurdgy.",OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse;
#     &AD_test_object({ldap=>$ldap,
#                    dn=>$dn_sigurdgy,
#                    #####
#                    displayName=>"Gylfi Þór Sigurðsson",
#                    givenName=>"Gylfi Þór",
#                    name=>$sigurdgy,
#                    sAMAccountname=>$sigurdgy,
#                    uidNumber=>"-1",
#                    homeDrive=>"H:",
#                    homeDirectory=>"\\\\linuxmuster.local\\default-school\\students\\7a\\homes\\".$sigurdgy,
#                    unixHomeDirectory=>"/srv/samba/schools/default-school/students/7a/homes/".$sigurdgy,
#                    sn=>"Sigurðsson",
#                    userPrincipalName => $sigurdgy."@".$root_dns,
#                    sophomorixAdminClass => "7a",
#                    sophomorixExitAdminClass => "unknown",
# #                   sophomorixFirstPassword => "Muster!",
#                    sophomorixFirstnameASCII => "Gylfi Thor",
#                    sophomorixSurnameASCII  => "Sigurdsson",
#                    sophomorixBirthdate  => "08.09.1989",
#                    sophomorixRole => "student",
#                    sophomorixSchoolPrefix => "---",
#                    sophomorixSchoolname => "default-school",
#                    sophomorixCreationDate => "exists",
#                    sophomorixTolerationDate => "exists",
#                    sophomorixDeactivationDate => "exists",
#                    sophomorixComment => "created by sophomorix",
#                    sophomorixExamMode => "---",
#                    sophomorixStatus => "R",
#                    sophomorixUnid => "---",
#                    userAccountControl => "514",
#                    memberOf => "7a|wifi|internet|webfilter|intranet|printing",
#                   });
    ##### Testing the users class
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=7a,OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"7a",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"7a",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$halldoha."|".$gunnarar."|".$sigurdra,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "students",
                   member => $halldoha."|".$gunnarar."|".$sigurdra,
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-m3kk3t,OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-m3kk3t",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"bsz-m3kk3t",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$mendelgr."|".$wallacal,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "bsz-students",
                   member => $mendelgr."|".$wallacal,
                  });
    ##### Testing the users ou-students group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=students,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-students",
                   member => "7a",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-students,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-students",
                   member => "bsz-m3kk3t",
                  });


    # koperni99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=koperni99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Nikolaus Kopernikus",
                   givenName=>"Nikolaus",
                   name=>"koperni99",
                   sAMAccountname=>"koperni99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\koperni99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/koperni99",
                   sn=>"Kopernikus",
                   userPrincipalName => "koperni99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Nikolaus",
                   sophomorixSurnameASCII  => "Kopernikus",
                   sophomorixBirthdate  => "19.02.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # darwi99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=darwi99,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Charles Darwin",
                   givenName=>"Charles",
                   name=>"darwi99",
                   sAMAccountname=>"darwi99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\bsz\\teachers\\homes\\darwi99",
                   unixHomeDirectory=>"/srv/samba/schools/bsz/teachers/homes/darwi99",
                   sn=>"Darwin",
                   userPrincipalName => "darwi99@".$root_dns,
                   sophomorixAdminClass => "bsz-teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Charles",
                   sophomorixSurnameASCII  => "Darwin",
                   sophomorixBirthdate  => "12.02.2009",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "bsz",
                   sophomorixSchoolname => "bsz",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "S",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "bsz-teachers|bsz-wifi|bsz-internet|bsz-webfilter|bsz-intranet|bsz-printing",
                  });

    # olinst99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=olinst99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ólafur Indriði Stefánsson",
                   givenName=>"Ólafur Indriði",
                   name=>"olinst99",
                   sAMAccountname=>"olinst99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\olinst99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/olinst99",
                   sn=>"Stefánsson",
                   userPrincipalName => "olinst99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster23!",
                   sophomorixFirstnameASCII => "Olafur Indridi",
                   sophomorixSurnameASCII  => "Stefansson",
                   sophomorixBirthdate  => "03.07.1973",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   sophomorixUnid => "---",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });

    # rukri99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=rukri99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Rúnar Kristinsson",
                   givenName=>"Rúnar",
                   name=>"rukri99",
                   sAMAccountname=>"rukri99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\rukri99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/rukri99",
                   sn=>"Kristinsson",
                   userPrincipalName => "rukri99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Runar",
                   sophomorixSurnameASCII  => "Kristinsson",
                   sophomorixBirthdate  => "05.09.1969",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # skula99
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=skula99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   #####
                   displayName=>"Ari Freyr Skúlason",
                   givenName=>"Ari Freyr",
                   name=>"skula99",
                   sAMAccountname=>"skula99",
                   uidNumber=>"-1",
                   homeDrive=>"H:",
                   homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\skula99",
                   unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/skula99",
                   sn=>"Skúlason",
                   userPrincipalName => "skula99@".$root_dns,
                   sophomorixAdminClass => "teachers",
                   sophomorixExitAdminClass => "unknown",
#                   sophomorixFirstPassword => "LinuxMuster!",
                   sophomorixFirstnameASCII => "Ari Freyr",
                   sophomorixSurnameASCII  => "Skulason",
                   sophomorixBirthdate  => "14.05.1987",
                   sophomorixRole => "teacher",
                   sophomorixSchoolPrefix => "---",
                   sophomorixSchoolname => "default-school",
                   sophomorixCreationDate => "exists",
                   sophomorixTolerationDate => "default",
                   sophomorixDeactivationDate => "default",
                   sophomorixComment => "created by sophomorix",
                   sophomorixExamMode => "---",
                   sophomorixStatus => "A",
                   userAccountControl => "512",
                   memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
                  });
    # bjarna99 must be killed by now
    &AD_object_nonexist($ldap,$root_dse,"user","bjarna99");
#     &AD_test_object({ldap=>$ldap,
#                    dn=>"CN=bjarna99,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
#                    #####
#                    displayName=>"Theódór Elmar Bjarnason",
#                    givenName=>"Theódór Elmar",
#                    name=>"bjarna99",
#                    sAMAccountname=>"bjarna99",
#                    uidNumber=>"-1",
#                    homeDrive=>"H:",
#                    homeDirectory=>"\\\\linuxmuster.local\\default-school\\teachers\\homes\\bjarna99",
#                    unixHomeDirectory=>"/srv/samba/schools/default-school/teachers/homes/bjarna99",
#                    sn=>"Bjarnason",
#                    userPrincipalName => "bjarna99@".$root_dns,
#                    sophomorixAdminClass => "teachers",
#                    sophomorixExitAdminClass => "unknown",
# #                   sophomorixFirstPassword => "LinuxMuster!",
#                    sophomorixFirstnameASCII => "Theodor Elmar",
#                    sophomorixSurnameASCII  => "Bjarnason",
#                    sophomorixBirthdate  => "04.03.1987",
#                    sophomorixRole => "teacher",
#                    sophomorixSchoolPrefix => "---",
#                    sophomorixSchoolname => "default-school",
#                    sophomorixCreationDate => "exists",
#                    sophomorixTolerationDate => "exists",
#                    sophomorixDeactivationDate => "exists",
#                    sophomorixComment => "created by sophomorix",
#                    sophomorixExamMode => "---",
#                    sophomorixStatus => "R",
#                    userAccountControl => "514",
#                    memberOf => "teachers|wifi|internet|webfilter|intranet|printing",
#                   });
    ##### Testing the users ou-teachers group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=teachers,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"rukri99|olinst99|skula99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-teachers",
                   member => "rukri99|olinst99|skula99",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-teachers,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"koperni99|darwi99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-teachers",
                   member => "koperni99|darwi99",
                  });


    # create the project p_full-blown
    my $pro_command="sophomorix-project $verbose_options ".
                    "--create -p full-blown  --description 'Full blown project' ".
                    "--addquota 100+60 --addmailquota 200 ".
                    "--mailalias --maillist ".
                    "--status P --join --nohide --maxmembers 36 ".
                    "--admins rukri99,olinst99 --members skula99,".$gunnarar.",".$halldoha." ".
                    "--membergroups 7a --admingroups teachers";

    &run_command("$pro_command");

    # test the project p_full-blown
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=p_full-blown,OU=Projects,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"p_full-blown",
                   gidNumber=>"-1",
                   description=>"Full blown project",
                   sophomorixType=>"project",
                   sophomorixAddQuota=>"100+60",
                   sophomorixAddMailQuota=>"200",
                   sophomorixMailAlias=>"TRUE",
                   sophomorixMailList=>"TRUE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMaxMembers=>"36",
                   sophomorixAdmins => "rukri99|olinst99",
                   sophomorixMembers => $halldoha."|".$gunnarar."|skula99",
                   sophomorixAdminGroups => "teachers",
                   sophomorixMemberGroups => "7a",
                   sophomorixCreationDate => "exists",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "",
                   member => "7a|teachers|rukri99|olinst99|skula99|".$halldoha."|".$gunnarar,
                  });







}



############################################################
# Deleting users --kill
############################################################
if ($kill_check==1){
    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";

    &run_command("sophomorix-user -K --user olinst99");
    &run_command("sophomorix-user -K --user rukri99");
    &run_command("sophomorix-user -K --user skula99");

    &run_command("sophomorix-user -K --user $halldoha");
    &run_command("sophomorix-user -K --user $gunnarar");
    &run_command("sophomorix-user -K --user $sigurdra");

    &run_command("sophomorix-check");
}

############################################################
if ($kill_check==1){
    # fetch loginnames:
    my ($mendelgr,$mendelgr_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Mendel",
                                givenName=>"Gregor",
                                birthdate=>"01.01.2000",
                               });
    my ($wallacal,$wallacal_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Wallace",
                                givenName=>"Alfred Russel",
                                birthdate=>"01.01.2000",
                               });
    my ($halldoha,$halldoha_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Halldórsson",
                                givenName=>"Hannes Þór",
                                birthdate=>"27.04.1984",
                               });
    my ($gunnarar,$gunnarar_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Gunnarsson",
                                givenName=>"Aron",
                                birthdate=>"22.04.1989",
                               });
    my ($sigurdra,$sigurdra_dn)=&AD_get_samaccountname({ldap=>$ldap,
                                root_dse=>$root_dse,
                                sn=>"Sigurðsson",
                                givenName=>"Ragnar",
                                birthdate=>"19.06.1986",
                               });
    print "U: $mendelgr\n";
    print "U: $wallacal\n";
    print "U: $halldoha\n";
    print "U: $gunnarar\n";
    print "U: $sigurdra\n";

    &run_command("sophomorix-kill");

    &AD_object_nonexist($ldap,$root_dse,"user",$halldoha);
    &AD_object_nonexist($ldap,$root_dse,"user",$gunnarar);
    &AD_object_nonexist($ldap,$root_dse,"user",$sigurdra);
    &AD_object_nonexist($ldap,$root_dse,"user","olinst99");
    &AD_object_nonexist($ldap,$root_dse,"user","rukri99");
    &AD_object_nonexist($ldap,$root_dse,"user","skula99");

    # killing rukri99,olinst99 should remove them from the project p_full-blown
    # 7a and teachers are still members, because they still exist
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=p_full-blown,OU=Projects,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"p_full-blown",
                   gidNumber=>"-1",
                   description=>"Full blown project",
                   sophomorixType=>"project",
                   sophomorixAddQuota=>"100+60",
                   sophomorixAddMailQuota=>"200",
                   sophomorixMailAlias=>"TRUE",
                   sophomorixMailList=>"TRUE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMaxMembers=>"36",
                   sophomorixAdmins => "",
                   sophomorixMembers => "",
                   sophomorixAdminGroups => "teachers",
                   sophomorixMemberGroups => "7a",
                   sophomorixCreationDate => "exists",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "",
                   member => "7a|teachers",
                  });

    ##### Testing the users ou-teachers group
    # empty sophomorixMembers,sophomorixAdmins but teachers is still member of project p_full-blown
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=teachers,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-teachers|p_full-blown",
                   member => "",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-teachers,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"koperni99|darwi99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-teachers",
                   member => "koperni99|darwi99",
                  });

    ##### Testing the users class
    # empty sophomorixMembers,sophomorixAdmins but 7a is still member of project p_full-blown
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=7a,OU=7a,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"7a",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"7a",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>"",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "students|p_full-blown",
                   member => "",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-m3kk3t,OU=m3kk3t,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-m3kk3t",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixType=>"adminclass",
                   description=>"bsz-m3kk3t",
                   sophomorixAddQuota=>"---",
                   sophomorixAddMailQuota=>"---",
                   sophomorixQuota=>"---",
                   sophomorixMailQuota=>"-1",
                   sophomorixMailAlias=>"FALSE",
                   sophomorixMailList=>"FALSE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMembers=>$mendelgr."|".$wallacal,
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "bsz-students",
                   member => $mendelgr."|".$wallacal,
                  });


    ##### Testing the users ou-students group
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=students,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-students",
                   member => "7a",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-students,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-students",
                   member => "bsz-m3kk3t",
                  });


    # kill class 7a
    &run_command("sophomorix-class --kill --class 7a $verbose_options");
    &AD_object_nonexist($ldap,$root_dse,"group","7a");

    # killing 7a should remove it from the project p_full-blown
    # group teachers is still a member, because it still exists
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=p_full-blown,OU=Projects,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"p_full-blown",
                   gidNumber=>"-1",
                   description=>"Full blown project",
                   sophomorixType=>"project",
                   sophomorixAddQuota=>"100+60",
                   sophomorixAddMailQuota=>"200",
                   sophomorixMailAlias=>"TRUE",
                   sophomorixMailList=>"TRUE",
                   sophomorixStatus=>"P",
                   sophomorixJoinable=>"TRUE",
                   sophomorixMaxMembers=>"36",
                   sophomorixAdmins => "",
                   sophomorixMembers => "",
                   sophomorixAdminGroups => "teachers",
                   sophomorixMemberGroups => "",
                   sophomorixCreationDate => "exists",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "",
                   member => "teachers",
                  });


    ##### Testing the users ou-teachers group
    # empty sophomorixMembers,sophomorixAdmins but teachers is still member of project p_full-blown
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=teachers,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-teachers|p_full-blown",
                   member => "",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-teachers,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"koperni99|darwi99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-teachers",
                   member => "koperni99|darwi99",
                  });

    # kill the project p_full-blown
    &run_command("sophomorix-project $verbose_options --kill -p full-blown");

    # test if project was deleted
    &AD_object_nonexist($ldap,$root_dse,"group","p_full-blown");

    ##### Testing the users ou-teachers group
    # teachers should be removed from p_full-blown
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=teachers,OU=Teachers,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-teachers",
                   member => "",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-teachers,OU=Teachers,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-teachers",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"teacherclass",
                   sophomorixMembers=>"koperni99|darwi99",
                   sophomorixAdmins=>"",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-teachers",
                   member => "koperni99|darwi99",
                  });

    ##### Testing the users ou-students group
    # should be empty
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=students,OU=Students,OU=default-school,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                   sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "default-school",
                   memberOf => "global-students",
                   member => "",
                  });
    &AD_test_object({ldap=>$ldap,
                   dn=>"CN=bsz-students,OU=Students,OU=bsz,OU=SCHOOLS,".$root_dse,
                   sAMAccountname=>"bsz-students",
                   gidNumber=>"-1",
                   sophomorixCreationDate => "exists",
                    sophomorixStatus=>"P",
                   sophomorixType=>"ouclass",
                   sophomorixHidden=>"FALSE",
                   sophomorixSchoolname => "bsz",
                   memberOf => "global-students",
                   member => "bsz-m3kk3t",
                  });

}



&AD_unbind_admin($ldap);



